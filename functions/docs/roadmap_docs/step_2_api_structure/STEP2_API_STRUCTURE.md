# 2λ‹¨κ³„: κΈ°λ³Έ API κµ¬μ΅° μ„¤μ • κ³„ν

## π“ λ©ν‘

VAST κ΄‘κ³  μ”μ²­μ„ μ²λ¦¬ν•κΈ° μ„ν• κΈ°λ³Έμ μΈ API κµ¬μ΅°λ¥Ό μ„¤μ •ν•κ³ , μ•μ •μ μ΄κ³  ν™•μ¥ κ°€λ¥ν• κΈ°λ°μ„ λ§λ ¨ν•©λ‹λ‹¤.

## π›  μ„Έλ¶€ μ‘μ—… ν•­λ©

### 1. κΈ°λ³Έ μ—”λ“ν¬μΈνΈ μ„¤μ •

- [ ] `/requestAds` μ—”λ“ν¬μΈνΈ μƒμ„±
  ```javascript
  exports.requestAds = onRequest(
    {
      region: "asia-northeast3",
      cors: true,
    },
    async (req, res) => {
      // κµ¬ν„ μμ •
    }
  );
  ```
- [ ] κΈ°λ³Έ λΌμ°ν… κµ¬μ΅° μ„¤μ •
- [ ] μ‘λ‹µ ν•μ‹ ν‘μ¤€ν™” (XML/JSON)

### 2. HTTP λ©”μ„λ“ λ° μ”μ²­ μ²λ¦¬

- [ ] GET λ©”μ„λ“ κµ¬ν„
  - μΏΌλ¦¬ νλΌλ―Έν„° μ •μ
  - ν•„μ νλΌλ―Έν„° κ²€μ¦
  - νλΌλ―Έν„° νƒ€μ… κ²€μ¦ (Zod μ‚¬μ©)
- [ ] μ”μ²­ ν—¤λ” μ²λ¦¬
  - Content-Type κ²€μ¦
  - User-Agent νμ‹±
  - Request IP μ²λ¦¬
- [ ] μ‘λ‹µ ν—¤λ” μ„¤μ •
  - XML Content-Type
  - Cache-Control

### 3. μ—λ¬ μ²λ¦¬ λ―Έλ“¤μ›¨μ–΄

- [ ] κΈ€λ΅λ² μ—λ¬ ν•Έλ“¤λ¬ κµ¬ν„
  - HTTP μƒνƒ μ½”λ“ λ§¤ν•‘
  - μ—λ¬ μ‘λ‹µ ν¬λ§· μ •μ
- [ ] μ£Όμ” μ—λ¬ νƒ€μ… μ •μ
  ```javascript
  const ErrorTypes = {
    INVALID_REQUEST: "INVALID_REQUEST",
    UNAUTHORIZED: "UNAUTHORIZED",
    NOT_FOUND: "NOT_FOUND",
    INTERNAL_ERROR: "INTERNAL_ERROR",
  };
  ```
- [ ] μ—λ¬ λ΅κΉ… κµ¬ν„
- [ ] μ»¤μ¤ν…€ μ—λ¬ ν΄λμ¤ κµ¬ν„

### 4. κΈ°λ³Έ λ΅κΉ… μ„¤μ •

- [ ] Firebase Functions κΈ°λ³Έ λ΅κ±° μ„¤μ •
  - λ΅κ·Έ λ λ²¨ μ •μ
  - κµ¬μ΅°ν™”λ λ΅κΉ… ν¬λ§· μ„¤μ •
- [ ] μ”μ²­/μ‘λ‹µ λ΅κΉ… λ―Έλ“¤μ›¨μ–΄
  - μ”μ²­ μ •λ³΄ λ΅κΉ… (IP, User-Agent, νλΌλ―Έν„°)
  - μ‘λ‹µ μƒνƒ λ° μ‹κ°„ λ΅κΉ…
- [ ] μ„±λ¥ λ©”νΈλ¦­ λ΅κΉ…
  - μ‘λ‹µ μ‹κ°„ μΈ΅μ •
  - λ©”λ¨λ¦¬ μ‚¬μ©λ‰ λ¨λ‹ν„°λ§

## π“ νμΌ κµ¬μ΅°

```
functions/
β”β”€β”€ src/
β”‚   β”β”€β”€ requestAds/
β”‚   β”‚   β”β”€β”€ index.js        # λ©”μΈ ν•Έλ“¤λ¬
β”‚   β”‚   β”β”€β”€ validator.js    # μ…λ ¥ κ²€μ¦ (Zod μ¤ν‚¤λ§)
β”‚   β”‚   β””β”€β”€ errors.js       # μ—λ¬ μ •μ
β”‚   β”β”€β”€ middleware/
β”‚   β”‚   β”β”€β”€ error.js        # μ—λ¬ μ²λ¦¬
β”‚   β”‚   β””β”€β”€ logging.js      # λ΅κΉ…
β”‚   β””β”€β”€ utils/
β”‚       β”β”€β”€ logger.js       # λ΅κ±° μ„¤μ •
β”‚       β””β”€β”€ metrics.js      # μ„±λ¥ λ©”νΈλ¦­
```

## β… μ™„λ£ μ΅°κ±΄

1. λ¨λ“  μ—”λ“ν¬μΈνΈκ°€ μ •μƒμ μΌλ΅ μ‘λ‹µ
2. μ—λ¬ μƒν™©μ—μ„ μ μ ν• μ—λ¬ μ‘λ‹µ λ°ν™
3. λ¨λ“  μ”μ²­/μ‘λ‹µμ΄ κµ¬μ΅°ν™”λμ–΄ λ΅κΉ…λ¨
4. μ…λ ¥κ°’ κ²€μ¦μ΄ μ •μƒμ μΌλ΅ λ™μ‘
5. μ„±λ¥ λ©”νΈλ¦­μ΄ μμ§‘λ¨

## π” ν…μ¤νΈ ν•­λ©

1. μ—”λ“ν¬μΈνΈ μ ‘κ·Όμ„± ν…μ¤νΈ
2. HTTP λ©”μ„λ“ κ²€μ¦
3. νλΌλ―Έν„° κ²€μ¦ ν…μ¤νΈ
4. μ—λ¬ μ²λ¦¬ ν…μ¤νΈ
5. λ΅κΉ… μ •μƒ λ™μ‘ ν™•μΈ
6. μ„±λ¥ λ©”νΈλ¦­ μμ§‘ ν™•μΈ

## π“ μ°Έκ³  μ‚¬ν•­

- Firebase Functions V2 λ¬Έμ„
- VAST 3.0 μ¤ν™
- Firebase λ΅κΉ… κ°€μ΄λ“
- Zod λ¬Έμ„
